"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[424],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=i.createContext({}),s=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(n),m=r,h=d["".concat(p,".").concat(m)]||d[m]||c[m]||a;return n?i.createElement(h,l(l({ref:t},u),{},{components:n})):i.createElement(h,l({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=d;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var s=2;s<a;s++)l[s]=n[s];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5118:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>o,toc:()=>s});var i=n(7462),r=(n(7294),n(3905));const a={sidebar_position:2},l="Build",o={unversionedId:"overview/build",id:"overview/build",title:"Build",description:"Cyclic apps are built and deployed into AWS from code that originates in Github.",source:"@site/docs/overview/build.md",sourceDirName:"overview",slug:"/overview/build",permalink:"/overview/build",draft:!1,editUrl:"https://github.com/cyclic-software/docs/blob/main/docs/overview/build.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/overview/architecture"},next:{title:"Deploy",permalink:"/overview/deploy"}},p={},s=[{value:"Code",id:"code",level:2},{value:"Customize the build process",id:"customize-the-build-process",level:2}],u={toc:s};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,i.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"build"},"Build"),(0,r.kt)("head",null,(0,r.kt)("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"})),(0,r.kt)("p",null,"Cyclic apps are built and deployed into AWS from code that originates in Github."),(0,r.kt)("p",null,"To trigger a build and deployment, install the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apps/cyclic-sh"},"Cyclic Github app")," on any public repo. On first installation we will assign your repo to an app and give it a public url such as ",(0,r.kt)("inlineCode",{parentName:"p"},"random-words.cyclic.app"),". We will then build and deploy your app as described below. On future commits to the default branch (for example: merges of PRs or pushes) Github will send a webhook api call to us. We will then perform the same build and deploy steps."),(0,r.kt)("p",null,"The input of the ",(0,r.kt)("strong",{parentName:"p"},"build")," step is a single commit in a git repo and the output is a zip archive that can be deployed and run inside of an AWS lambda with the Cyclic lambda runtime."),(0,r.kt)("div",{style:{textAlign:"center"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Cyclic Github app installation API call pattern",src:n(3922).Z,title:"Cyclic Github app installation",width:"513",height:"311"}))),(0,r.kt)("h2",{id:"code"},"Code"),(0,r.kt)("p",null,"The following is a close approximation of the code we use to take your code repo and turn it into an artifact that can be run inside of AWS Lambda with the Cyclic lambda runtime."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": we use ",(0,r.kt)("inlineCode",{parentName:"p"},"npm")," version 8.13.1 throughout."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"npm install"),": Install your code's dependencies (including ",(0,r.kt)("inlineCode",{parentName:"li"},"devDependencies"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"npm run build"),": Build your app if you have a ",(0,r.kt)("inlineCode",{parentName:"li"},"build")," script defined in ",(0,r.kt)("inlineCode",{parentName:"li"},"package.json")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"npm prune"),": Prune any ",(0,r.kt)("inlineCode",{parentName:"li"},"devDependencies")," to minimize the size of the output zip"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"zip"),": Zip all of your code and installed dependencies (for example ",(0,r.kt)("inlineCode",{parentName:"li"},"node_modules"),") recursively")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": we have limits on the maximum amount of disk space used for code + dependencies while building and on the final bundle size. See ",(0,r.kt)("a",{parentName:"p",href:"/overview/limits"},"limits page")," for more details."),(0,r.kt)("h2",{id:"customize-the-build-process"},"Customize the build process"),(0,r.kt)("p",null,"NPM executes several ",(0,r.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/v8/using-npm/scripts#npm-install"},"lifecycle scripts")," as part of the ",(0,r.kt)("inlineCode",{parentName:"p"},"npm install")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run build"),". According to the documentation these are run in the following order:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"npm install"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"preinstall")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"install")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"postinstall")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"prepublish")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"preprepare")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"prepare")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"postprepare"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"npm run build"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"prebuild")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"build")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"postbuild"))),(0,r.kt)("p",null,"If you have particular needs try putting it into the appropriate lifecycle script. If you have needs beyond what these lifecycle scripts can provide or they don't solve for your use case send us an email: ",(0,r.kt)("i",{className:"far fa-envelope"})," ",(0,r.kt)("a",{parentName:"p",href:"mailto:hello@cyclic.sh"},"hello@cyclic.sh")," or join us on ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/huhcqxXCbE"},(0,r.kt)("i",{className:"fab fa-discord"}),"  Discord")))}c.isMDXComponent=!0},3922:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/build-process.drawio-9779c9c0b971713df2e0e5bfb58789c9.png"}}]);