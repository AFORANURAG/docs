"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[297],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return u}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=c(n),u=r,k=m["".concat(s,".").concat(u)]||m[u]||p[u]||i;return n?a.createElement(k,o(o({ref:t},d),{},{components:n})):a.createElement(k,o({ref:t},d))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2760:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return p}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={sidebar_position:4},s="Databases",c={unversionedId:"concepts/database",id:"concepts/database",title:"Databases",description:"Apps have access to a pre-configured AWS DynamoDB Table. External databases can be integrated by setting their connection strings as environment variables.",source:"@site/docs/concepts/database.md",sourceDirName:"concepts",slug:"/concepts/database",permalink:"/docs/concepts/database",draft:!1,editUrl:"https://github.com/cyclic-software/docs/edit/main/website/docs/concepts/database.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Hosting",permalink:"/docs/concepts/hosting"},next:{title:"Transactions",permalink:"/docs/concepts/transactions"}},d={},p=[{value:"DynamoDB (Preview)",id:"dynamodb-preview",level:2},{value:"Using DynamoDB with the <code>cyclic-dynamodb</code> Package",id:"using-dynamodb-with-the-cyclic-dynamodb-package",level:3},{value:"Collection Items",id:"collection-items",level:3},{value:"Item Fragments",id:"item-fragments",level:3},{value:"Using DynamoDB Directly",id:"using-dynamodb-directly",level:2}],m={toc:p};function u(e){var t=e.components,l=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"databases"},"Databases"),(0,i.kt)("p",null,"Apps have access to a pre-configured AWS DynamoDB Table. External databases can be integrated by setting their connection strings as environment variables."),(0,i.kt)("h2",{id:"dynamodb-preview"},"DynamoDB (Preview)"),(0,i.kt)("p",null,"An enhanced single-table database built on the fast and globally scalable DynamoDB.\nOn top of DynamoDB NoSQL functionality and table there is a number of additional resources that enable features including:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Simple Key-Value inspired SDK"),(0,i.kt)("li",{parentName:"ul"},"Write-Time Indexing"),(0,i.kt)("li",{parentName:"ul"},"Flexible Queries"),(0,i.kt)("li",{parentName:"ul"},"JSON Schema Discovery")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Local Dev ")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"When deployed Cyclic apps are directly integrated with AWS resources with no need any additional config.\nWhen developing and interacting with AWS on local, use credentials provided on the ",(0,i.kt)("inlineCode",{parentName:"p"},"Data / Storage")," tab of an app."),(0,i.kt)("p",{parentName:"div"},(0,i.kt)("img",{alt:"Transaction Request",src:n(3123).Z,title:"Transaction Request",width:"2278",height:"536"})),(0,i.kt)("p",{parentName:"div"},"The credentials are temporary and expire after 60 minutes. New credentials can be retrieved by reloading the page."))),(0,i.kt)("h3",{id:"using-dynamodb-with-the-cyclic-dynamodb-package"},"Using DynamoDB with the ",(0,i.kt)("inlineCode",{parentName:"h3"},"cyclic-dynamodb")," Package"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/db-sdk"},"GitHub")," | ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/cyclic-dynamodb"},"NPM")),(0,i.kt)("p",null,"The sdk simplifies the DynamoDB interface and enables collection organization of records, queries and data scheme discovery among other features."),(0,i.kt)("h3",{id:"collection-items"},"Collection Items"),(0,i.kt)("p",null,"The package organizes items into the following structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "collection": "animals",\n  "key": "luna",\n  "props": {\n    "updated": "2022-03-23T13:02:12.702Z",\n    "created": "2022-03-23T12:32:02.526Z",\n    "color": "orange",\n    "type": "cat"\n  },\n  "$index": [\n    "color"\n  ]\n}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"key")," should be used to uniquely identify an item and it's set of child items."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"$index")," is a list of ",(0,i.kt)("inlineCode",{parentName:"p"},"props")," by which them item will be indexed. key-value pairs that have been indexed can be used to retrieve or query items with greater performance."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// example.js\n\nprocess.env.CYCLIC_DB = 'your-url-subdomainCyclicDB'\nconst db = require('cyclic-dynamodb')\n\nconst run = async function(){\n    let animals = db.collection('animals')\n\n    // create an item in collection with key \"leo\"\n    let leo = await animals.set('leo', {\n        type:'cat',\n        color:'orange'\n    })\n\n    // get an item at key \"leo\" from collection animals\n    let item = await animals.get('leo')\n    console.log(item)\n}\nrun()\n\n")),(0,i.kt)("h3",{id:"item-fragments"},"Item Fragments"),(0,i.kt)("p",null,"With the cyclic data model, items can have fragments. These can be thought of as children or attachments to items."),(0,i.kt)("p",null,"Another way to think of fragments is by thinking of an item itself as its own collection of other items that are stored closely together."),(0,i.kt)("p",null,"An example use case for a user record would be something like:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"item user: name, last name, id",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"fragment home: address, city"),(0,i.kt)("li",{parentName:"ul"},"fragment work: company name, position, work address\nFragments objects look just like items but give you a way to better organize your data with higher query performance.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"let users = db.collection('users')\n\nawait users.item('mike')\n        .fragment('work').set({\n            company: 'cyclic'\n        })\n\nlet mikes_work = await users.item('mike').fragment('work').get()\n")),(0,i.kt)("h2",{id:"using-dynamodb-directly"},"Using DynamoDB Directly"),(0,i.kt)("p",null,"If you choose not to use the open source ",(0,i.kt)("inlineCode",{parentName:"p"},"cyclic-dynamodb")," package, apps have CRUD access to the table and can make use of the table's generic raw schema directly. "),(0,i.kt)("p",null,"When using the table directly with AWS DynamoDB SDK or other third party SDK's, the following fields and indexes can be used:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"IndexName"),(0,i.kt)("th",{parentName:"tr",align:null},"Partition Key"),(0,i.kt)("th",{parentName:"tr",align:null},"Range Key"),(0,i.kt)("th",{parentName:"tr",align:null},"Projected Fields"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"primary"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"pk")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"sk")),(0,i.kt)("td",{parentName:"tr",align:null},"all")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"keys_gsi"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"keys_gsi")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"keys_gsi_sk")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"pk"),",",(0,i.kt)("inlineCode",{parentName:"td"},"sk"),", ",(0,i.kt)("inlineCode",{parentName:"td"},"gsi_prj"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"gsi_prj"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"gsi_prj")),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"prj"))))),(0,i.kt)("p",null,"The table also has several attribute names that are reserved and should not be used directly:\n",(0,i.kt)("inlineCode",{parentName:"p"},"gsi1"),",",(0,i.kt)("inlineCode",{parentName:"p"},"gsi2"),",",(0,i.kt)("inlineCode",{parentName:"p"},"gsi_s"),",",(0,i.kt)("inlineCode",{parentName:"p"},"gsi_s_sk"),",",(0,i.kt)("inlineCode",{parentName:"p"},"gsi_s2"),",",(0,i.kt)("inlineCode",{parentName:"p"},"gsi_s2_sk")),(0,i.kt)("p",null,"An additional attribute ",(0,i.kt)("inlineCode",{parentName:"p"},"ttl")," is reserved and drives record expiration as specified by standard ",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/TTL.html"},"DynamoDB")))}u.isMDXComponent=!0},3123:function(e,t,n){t.Z=n.p+"assets/images/creds-1a9d341ebc49ab6d32ab8a7eb60ee521.png"}}]);