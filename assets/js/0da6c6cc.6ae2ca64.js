"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[853],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),h=p(a),d=r,m=h["".concat(l,".").concat(d)]||h[d]||u[d]||i;return a?n.createElement(m,s(s({ref:t},c),{},{components:a})):n.createElement(m,s({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var p=2;p<i;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},5218:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:2},s="Creating routes to fetch and search data",o={unversionedId:"tutorials/rest-api-and-dynamodb/part-2",id:"tutorials/rest-api-and-dynamodb/part-2",title:"Creating routes to fetch and search data",description:"With our database full with data, it's time to build a RESTful API that allows us to fetch that data in four different ways:",source:"@site/docs/tutorials/rest-api-and-dynamodb/part-2.md",sourceDirName:"tutorials/rest-api-and-dynamodb",slug:"/tutorials/rest-api-and-dynamodb/part-2",permalink:"/tutorials/rest-api-and-dynamodb/part-2",draft:!1,editUrl:"https://github.com/cyclic-software/docs/blob/main/docs/tutorials/rest-api-and-dynamodb/part-2.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Getting Started with a RESTful API",permalink:"/tutorials/rest-api-and-dynamodb/part-1"},next:{title:"Creating routes to create and replace data",permalink:"/tutorials/rest-api-and-dynamodb/part-3"}},l={},p=[{value:"Fetching all bikes",id:"fetching-all-bikes",level:2},{value:"Fetching a bike by ID",id:"fetching-a-bike-by-id",level:2},{value:"Fetching a bike by handle",id:"fetching-a-bike-by-handle",level:2},{value:"Fetching bikes by search on title",id:"fetching-bikes-by-search-on-title",level:2}],c={toc:p};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"creating-routes-to-fetch-and-search-data"},"Creating routes to fetch and search data"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{alt:"Four HTTP GET routes: list all, get by id, get by handle, and search by title.",src:"/img/tutorial/rest-api/GET_Routes.png",width:"640"})),(0,r.kt)("p",null,"With our database full with data, it's time to build a RESTful API that allows us to fetch that data in four different ways:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"GET all bikes"),(0,r.kt)("li",{parentName:"ol"},"GET bike by ID"),(0,r.kt)("li",{parentName:"ol"},"GET bike by handle"),(0,r.kt)("li",{parentName:"ol"},"GET bikes by search query")),(0,r.kt)("p",null,"Get started by creating a ",(0,r.kt)("inlineCode",{parentName:"p"},"router.js")," file. This file will contain and export an Express ",(0,r.kt)("strong",{parentName:"p"},"Router")," (the entity that handles URLs with different HTTP verbs), processes them, and returns a response. This entire process is customizable by us, the programmers of the HTTP server."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// router.js\n\nimport { Router } from "express";\n\n// Initialize Express router\nexport const router = Router();\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"We can now use the ",(0,r.kt)("inlineCode",{parentName:"p"},"router")," object to define a variety of HTTP request handlers for this server. But to make it work, we must attach it to the ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," file, which is executed by Cyclic when the server is first started using ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run dev"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// index.js\n\nimport { router as bikesRouter } from "./router.js"; // this is the new import\n\nimport express from "express";\n\nconst app = express();\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\napp.use("/bikes", bikesRouter); // this is the new line\n\nconst port = process.env.PORT || 3000;\napp.listen(port, () => {\n  console.log(`Listening on port ${port}`);\n});\n\n// delete all other lines after this\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/index.js"},"Link to full code.")),(0,r.kt)("p",null,"This implies that all URL paths that begin with ",(0,r.kt)("inlineCode",{parentName:"p"},"/bikes")," will be handled by the router defined in the ",(0,r.kt)("inlineCode",{parentName:"p"},"router.js")," script. (e.g ",(0,r.kt)("inlineCode",{parentName:"p"},"/bikes/all"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"/bikes"),", \u2026)"),(0,r.kt)("h2",{id:"fetching-all-bikes"},"Fetching all bikes"),(0,r.kt)("p",null,"Our very first route handler is pretty simple: it's a handler for the ",(0,r.kt)("inlineCode",{parentName:"p"},"/bikes/all")," URL with the GET action, always returning a list of ",(0,r.kt)("em",{parentName:"p"},"all")," bikes in the database."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In large APIs that depend on huge databases (such as Instagram and Twitter), it's common to see support for ",(0,r.kt)("a",{parentName:"p",href:"https://developer.atlassian.com/server/confluence/pagination-in-the-rest-api/"},"pagination"),", a feature that allows the API's users to only fetch part of the database. (since it's nearly impossible to return a list of one million items in just one HTTP response, for example.)")),(0,r.kt)("p",null,"We haven't created a route handler, yet. Thankfully, all of them generally follow the same pattern:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'router.get("/all", async (req, res) => {\n  res.send([]);\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"As you can see, we're telling Express to handle the GET action on the ",(0,r.kt)("inlineCode",{parentName:"p"},"/all")," route by running the ",(0,r.kt)("inlineCode",{parentName:"p"},"router.get")," method. If we wished to support the POST action instead for example, we would do ",(0,r.kt)("inlineCode",{parentName:"p"},"router.post"),", as we'll see in the next section of this guide."),(0,r.kt)("p",null,"Route handlers also take a ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Glossary/Callback_function"},"callback function")," as their second parameter; that's a function that takes two parameters itself:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"HTTP Request:")," as the first parameter passed to this function (which we conveniently named ",(0,r.kt)("inlineCode",{parentName:"li"},"req"),"), it's an object that contains all kinds of information about the HTTP request including but not limited to the query strings, body data and even HTTP headers."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"HTTP Response:")," this is the second parameter, and it's used to fill the HTTP response with some information before sending it back to the client using the ",(0,r.kt)("inlineCode",{parentName:"li"},"res.send")," method. For now, we're simply returning an empty ",(0,r.kt)("inlineCode",{parentName:"li"},"Array"),", but we'll soon populate it with bikes data.")),(0,r.kt)("p",null,"And notice how we're using an ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"},"asynchronous function")," as the callback. While not required, it's important to note that it's well-supported with Express and we'll be using it to wait for DynamoDB to return its data. Of course, we could also use ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises"},"Promises")," instead."),(0,r.kt)("p",null,"It's time to start making calls to our DynamoDB instance to actually fetch some data. Let's get started by creating an instance of our bikes collection, giving us access to a variety of methods for manipulating our database:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Initialize AWS DynamoDB\nconst db = DynamoDb(process.env.CYCLIC_DB);\nconst bikesCollection = db.collection("bikes");\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"As you can see, we're using the ",(0,r.kt)("inlineCode",{parentName:"p"},"cyclic-dynamodb")," library to create a programmable instance of our database. That's a convenience library used to facilitate the communication with our database using simple JavaScript code. We're also extracting the ",(0,r.kt)("inlineCode",{parentName:"p"},"CYCLIC_DB")," environment variable that we set earlier using ",(0,r.kt)("inlineCode",{parentName:"p"},"process.env"),". "),(0,r.kt)("p",null,"Let's move back into our route handler to finally make some use of this ",(0,r.kt)("inlineCode",{parentName:"p"},"bikesCollection")," object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Get all bikes\nrouter.get("/all", async (req, res) => {\n  const { results: bikesMetadata } = await bikesCollection.list();\n\n  const bikes = await Promise.all(\n    bikesMetadata.map(async ({ key }) => (await bikesCollection.get(key)).props)\n  );\n\n  res.send(bikes);\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"Let's dissect the above code snippet line-by-line:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"We're calling the asynchronous ",(0,r.kt)("inlineCode",{parentName:"p"},"list()")," method that returns an object containing the results field. Being the only interesting field, we're directly extracting it using JavaScript ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"},"Destructing Assignment")," and renaming it to ",(0,r.kt)("inlineCode",{parentName:"p"},"bikesMetadata"),". This final object, however, does not contain the bike's data; it's only giving us the IDs (or \"Keys\") of those bikes."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const { results: bikesMetadata } = await bikesCollection.list();\n// bikesMetadata = [\n// { key: '...' },\n// { key: '...' },\n// ]\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"We're iterating over every bike key and using the asynchronous ",(0,r.kt)("inlineCode",{parentName:"p"},"get()")," method to fetch the ",(0,r.kt)("em",{parentName:"p"},"actual")," bike data, stored in the props field. The result is an array of Promises, which we await to all be resolved using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise.all")," method."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const bikes = await Promise.all(\n  bikesMetadata.map(\n    async ({ key }) =>\n      (\n        await bikesCollection.get(key)\n      ).props // { props: { ... } }\n  ) // { title, inStock, ... } (actually a Promise!)\n);\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"We're finally sending an array of bike data back in the HTTP response. "))),(0,r.kt)("p",null,"All looking good! Since our server is automatically restarted when we change our code (a consequence of running ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/nodemon"},(0,r.kt)("inlineCode",{parentName:"a"},"nodemon")),"), we can directly go debug it using ",(0,r.kt)("inlineCode",{parentName:"p"},"cURL"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:3000/bikes/all | jq .\n")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{alt:"Response to the last command.",src:"/img/tutorial/rest-api/api-all.svg",width:"640"})),(0,r.kt)("h2",{id:"fetching-a-bike-by-id"},"Fetching a bike by ID"),(0,r.kt)("p",null,"We just figured out how to fetch a full list of bikes using DynamoDB, but within that piece of code, we nested a little snippet that fetched a bike using its ID (or key):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"await bikesCollection.get(key).props;\n")),(0,r.kt)("p",null,"We'll be using that command to build the remainder of this route. But first of all, it's important to first model our URL. Since our API follows the REST standard, it's best practice to name it like the following: ",(0,r.kt)("inlineCode",{parentName:"p"},"/bikes/<ID>"),". As you can see, the ID is encoded directly in the URL itself, so how do we tell Express to extract this specific part of the URL?"),(0,r.kt)("p",null,"The answer is relatively simple: when using Express, all we have to do is simply replace the dynamic part of the URL with a colon and give it a name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Get bike by ID\nrouter.get("/:id", async (req, res) => {\n  const id = req.params.id;\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"As you can see, we're inserting ",(0,r.kt)("inlineCode",{parentName:"p"},":id")," into our URL and proceed to extract it from the ",(0,r.kt)("inlineCode",{parentName:"p"},"req.params")," object."),(0,r.kt)("p",null,"With the ID now in our hands, we can use that code snippet we just saw to extract specific data from DynamoDB:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Get bike by ID\nrouter.get("/:id", async (req, res) => {\n  const id = req.params.id;\n\n  const { props: bike } = await bikesCollection.get(id);\n  res.send(bike);\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"Let's test that:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:3000/bikes/<ID> | jq . # replace <ID> with an ID from the response to /all\n")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{alt:"Response to the last command.",src:"/img/tutorial/rest-api/http-get-id.svg",width:"640"})),(0,r.kt)("p",null,"But what if the item with that ID doesn't exist? In that case, we wish to return an HTTP response with the 404 status code, indicating that the resource does not exist."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Get bike by ID\nrouter.get("/:id", async (req, res) => {\n  const id = req.params.id;\n\n  try {\n    const { props: bike } = await bikesCollection.get(id);\n    res.send(bike);\n  } catch (e) {\n    console.log(`GET /${id}`, e.message);\n    res.sendStatus(404);\n  }\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"Let's see if that works: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:3000/bikes/blahblah\n")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{alt:"Response to the last command.",src:"/img/tutorial/rest-api/api-blahblah.svg",width:"640"})),(0,r.kt)("h2",{id:"fetching-a-bike-by-handle"},"Fetching a bike by handle"),(0,r.kt)("p",null,"Okay, so we're using IDs to index our bike items. But they're just a random mix of numbers and letters, designed to generate a unique ID per item."),(0,r.kt)("p",null,'The alternative is "handles", ',(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Glossary/Slug"},"slugified")," versions of the title that are still unique."),(0,r.kt)("p",null,"Let's extract them from the route:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Get bike by handle\nrouter.get("/by-handle/:handle", async (req, res) => {\n  const handle = req.params.handle;\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"We can't just run the ",(0,r.kt)("inlineCode",{parentName:"p"},"get()")," method this time, since we don't have the item's key."),(0,r.kt)("p",null,"One thing we could do, of course, is to get a list of every bike item and check the handle of each one. That, however, is not very efficient."),(0,r.kt)("p",null,"Thankfully, we can use Cyclic's DynamoDB object to ",(0,r.kt)("strong",{parentName:"p"},"filter")," the bike items and only keep the ones that match our handle:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const { results } = await bikesCollection.filter({ handle });\n")),(0,r.kt)("p",null,"This method, unlike ",(0,r.kt)("inlineCode",{parentName:"p"},"list()"),", returns the full data for each found item. Let's extract our bike's data and send it back to the client:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Get bike by handle\nrouter.get("/by-handle/:handle", async (req, res) => {\n  const handle = req.params.handle;\n\n  const { results } = await bikesCollection.filter({ handle });\n  const { props: bike } = results[0];\n\n  res.send(bike);\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"And let's not forget to do some error handling in case no bike object matches that particular handle. That's tested by checking the truthiness of ",(0,r.kt)("inlineCode",{parentName:"p"},"results.length"),", returning ",(0,r.kt)("inlineCode",{parentName:"p"},"False")," when it's an empty array."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Get bike by handle\nrouter.get("/by-handle/:handle", async (req, res) => {\n  const handle = req.params.handle;\n\n  try {\n    const { results } = await bikesCollection.filter({ handle });\n    if (!results.length) throw new Error();\n\n    const { props: bike } = results[0];\n    res.send(bike);\n  } catch (e) {\n    console.log(`GET /bikes/by-handle/${handle}`, e.message);\n    res.sendStatus(404);\n  }\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"And of course, we should always battle-test our API before shipping it to the Internet:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:3000/bikes/by-handle/<HANDLE> | jq . # replace <HANDLE> with a handle from the response to /all\n")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{alt:"Response to the last command.",src:"/img/tutorial/rest-api/api-handle.svg",width:"640"})),(0,r.kt)("h2",{id:"fetching-bikes-by-search-on-title"},"Fetching bikes by search on title"),(0,r.kt)("p",null,"Search is one of the most important features in a website. It's how users discover new products without having to browse a list of hundreds or even thousands of items. Implementing it, however, is not so simple."),(0,r.kt)("p",null,"The most popular search engines have to take a plethora of things into account: ignoring pronouns and uppercase characters, handling misspelled words, etc\u2026"),(0,r.kt)("p",null,"In fact, DynamoDB comes with full support for ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/about-aws/whats-new/2015/08/amazon-dynamodb-elasticsearch-integration/"},"ElasticSearch"),", a powerful search engine developed  used by some of the biggest applications out there."),(0,r.kt)("p",null,"But for the purposes of this tutorial, we'll stick with something more simple. DynamoDB also supports scans: SQL-like querying that handles many powerful ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/reference/dynamodb/scan.html"},"expressions"),"."),(0,r.kt)("p",null,"Scans take-in expressions: powerful combinations of built-in commands, such as ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"contains")),". That's a command that facilitates the ability to check whether one of an item's fields ",(0,r.kt)("em",{parentName:"p"},"contains")," a string of characters. Unfortunately, it does not support any advanced search-like features such as ignoring uppercase or lowercase characters, but it's useful enough for a simple application."),(0,r.kt)("p",null,"But before we delve deeper into DynamoDB Scans, let's write the fundamentals of our new router."),(0,r.kt)("p",null,"We'll be using query strings this time, also called ",(0,r.kt)("strong",{parentName:"p"},"GET parameters"),"."),(0,r.kt)("p",null,"They simply are key-value pairs encoded in the right-hand side of a URL in the following manner: ",(0,r.kt)("inlineCode",{parentName:"p"},"/bikes/search/by-title?term=<QUERY>"),' (in this case, "term" is the GET parameter with the value  ',(0,r.kt)("inlineCode",{parentName:"p"},"<TERM>"),")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Search bikes by title\nrouter.get("/search/by-title", async (req, res) => {\n  const term = req.query.term || "";\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"Let's proceed now by using this search term to look-up some data. The function that we're looking for is ",(0,r.kt)("inlineCode",{parentName:"p"},"parallel_scan"),", taking the expression ",(0,r.kt)("inlineCode",{parentName:"p"},"contains(title, <TERM>)"),". However, we must split this expression into its three parts:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"The expression itself:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"contains()")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"The attribute name:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"title")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"The attribute value:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"<TERM>"))),(0,r.kt)("p",null,"We can combine these 3 parts into one by replacing the attribute name with ",(0,r.kt)("inlineCode",{parentName:"p"},"#title")," and its value with ",(0,r.kt)("inlineCode",{parentName:"p"},":value"),", we can then replace these placeholders with the real values:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const { results } = await bikesCollection.parallel_scan({\n  expression: "contains(#title, :title)",\n  attr_names: {\n    "#title": "title",\n  },\n  attr_vals: {\n    ":title": query,\n  },\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"Let's see how that fits into the router code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Search bikes by title\nrouter.get("/search/by-title", async (req, res) => {\n  const query = req.query.query || "";\n\n  const { results } = await bikesCollection.parallel_scan({\n    expression: "contains(#title, :title)",\n    attr_names: {\n      "#title": "title",\n    },\n    attr_vals: {\n      ":title": query,\n    },\n  });\n\n  const bikes = results.map(({ props }) => props);\n  res.send(bikes);\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,"And with the same error handling, it's even more robust:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Search bikes by title\nrouter.get("/search/by-title", async (req, res) => {\n  const query = req.query.query || "";\n\n  try {\n    const { results } = await bikesCollection.parallel_scan({\n      expression: "contains(#title, :title)",\n      attr_names: {\n        "#title": "title",\n      },\n      attr_vals: {\n        ":title": query,\n      },\n    });\n\n    const bikes = results.map(({ props }) => props);\n    res.send(bikes);\n  } catch (e) {\n    console.log(`GET /bikes/search/by-title term="${query}"`, e.message);\n    res.sendStatus(400);\n  }\n});\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyclic-software/tutorial-bikes-api/blob/main/router.js"},"Link to full code.")),(0,r.kt)("p",null,'Let\'s try it out! Make a search with the term "Bicycle" (case-sensitive) and see the results:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:3000/bikes/search/by-title\\?query\\=Bicycle | jq .\n")),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{alt:"Response to the last command.",src:"/img/tutorial/rest-api/api-search.svg",width:"640"})),(0,r.kt)("p",null,"In the ",(0,r.kt)("a",{parentName:"p",href:"./part-3"},"next part")," of this series, we'll add more functionality that gives us the ability to create and replace data in the bikes database."))}u.isMDXComponent=!0}}]);